<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª Test-Modus - KI-Lern-Buddy</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1>ğŸ§ª KI-Lern-Buddy - Test-Modus</h1>
                <p>Teste dein Wissen mit personalisierten Fragen</p>
            </div>
            <div class="user-info">
                <span id="usernameDisplay">Lade...</span>
                <button class="logout" onclick="goToDashboard()">ğŸ“Š Dashboard</button>
                <button onclick="toggleDebug()" style="background: #6c757d; padding: 5px 10px; font-size: 12px;">Debug</button>
            </div>
        </header>

        <div id="debug" class="debug"></div>

        <!-- Test-Konfiguration -->
        <div id="testSetup" class="card">
            <h2>ğŸ¯ Test konfigurieren</h2>
            <div class="form-group">
                <input type="text" id="testSubject" placeholder="Fach" value="Mathe">
                <input type="text" id="testTopic" placeholder="Thema" value="Analysis">
                <select id="questionCount">
                    <option value="5">5 Fragen</option>
                    <option value="10" selected>10 Fragen</option>
                    <option value="15">15 Fragen</option>
                    <option value="20">20 Fragen</option>
                </select>
                <button onclick="startTest()" id="startTestBtn">ğŸš€ Test starten</button>
            </div>
        </div>

        <div id="testLoading" class="card hidden" style="text-align: center; padding: 60px 20px;" class="spinning">
            <div style="font-size: 4rem; animation: spin 1.5s infinite;">âš™ï¸</div>
            <h2 style="margin-top: 20px; color: #333;">Generiere Test...</h2>
            
            <div style="margin: 20px auto; max-width: 400px; background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid #667eea; text-align: left;">
                <p><strong>Fach:</strong> <span id="loadingSubject">...</span></p>
                <p><strong>Thema:</strong> <span id="loadingTopic">...</span></p>
                <p><strong>Umfang:</strong> <span id="loadingCount">...</span> Fragen</p>
            </div>
            
            <p style="color: #666; font-style: italic; margin-top: 20px;">
                Die KI erstellt gerade maÃŸgeschneiderte Aufgaben fÃ¼r dich.<br>
                Das dauert einen kleinen Moment...
            </p>
        </div>

        <!-- Aktiver Test -->
        <div id="activeTest" class="card hidden">
            <div class="test-header">
                <div>
                    <strong id="testInfo">Fach: Lade...</strong>
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button onclick="togglePause()" id="pauseBtn" class="secondary" style="padding: 5px 10px;">â¸ï¸</button>
                    <div class="timer" id="timer">60:00</div>
                </div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>

            <div class="question-container">
                <div class="question-number" id="questionNumber">Frage #1</div>
                <div class="question-text" id="questionText">Lade Frage...</div>
                
                <!-- Multiple Choice Options -->
                <div class="mc-options" id="mcOptions" style="margin: 20px 0;">
                    <div class="mc-option" id="optionAContainer">
                        <input type="checkbox" id="optionA" value="A">
                        <label for="optionA"><span id="labelA">A) Lade Option A...</span></label>
                    </div>
                    <div class="mc-option" id="optionBContainer">
                        <input type="checkbox" id="optionB" value="B">
                        <label for="optionB"><span id="labelB">B) Lade Option B...</span></label>
                    </div>
                    <div class="mc-option" id="optionCContainer">
                        <input type="checkbox" id="optionC" value="C">
                        <label for="optionC"><span id="labelC">C) Lade Option C...</span></label>
                    </div>
                    <div class="mc-option" id="optionDContainer">
                        <input type="checkbox" id="optionD" value="D">
                        <label for="optionD"><span id="labelD">D) Lade Option D...</span></label>
                    </div>
                    <div class="mc-option hidden" id="optionEContainer">
                        <input type="checkbox" id="optionE" value="E">
                        <label for="optionE"><span id="labelE">E) Lade Option E...</span></label>
                    </div>
                    <div class="mc-option hidden" id="optionFContainer">
                        <input type="checkbox" id="optionF" value="F">
                        <label for="optionF"><span id="labelF">F) Lade Option F...</span></label>
                    </div>
                </div>

                <div class="feedback-container hidden" id="singleQuestionFeedback">
                    <h4>ğŸ“ Feedback:</h4>
                    <div id="feedbackContent">Lade Feedback...</div>
                </div>

                <div class="navigation-buttons">
                    <button onclick="previousQuestion()" id="prevBtn" class="secondary">â¬…ï¸ Vorherige</button>
                    <button onclick="nextQuestion()" id="nextBtn" class="secondary">NÃ¤chste â¡ï¸</button>
                    <button onclick="finishTest()" id="finishBtn" class="success">ğŸ Test beenden</button>
                </div>
            </div>
        </div>

        <!-- Testergebnis - NEUE STRUKTUR -->
        <div id="testResult" class="card hidden">
            <div class="result-content">
                <h2>ğŸ“Š Testergebnis</h2>
                
                <!-- DEBUG BUTTONS -->
                <div style="text-align: center; margin: 10px 0;">
                    <button onclick="debugElements()" style="background: #17a2b8; padding: 5px 10px; font-size: 12px; margin: 5px;">
                        ğŸ” Debug Elements
                    </button>
                    <button onclick="forceRender()" style="background: #6f42c1; padding: 5px 10px; font-size: 12px; margin: 5px;">
                        ğŸ”„ Force Render
                    </button>
                </div>
                
                <div class="score-circle" id="scoreCircle">0%</div>
                <div id="performanceBadge" class="performance-badge">Lade...</div>
                
                <div style="margin: 20px 0; font-size: 1.1em;">
                    <p><strong>Richtige Antworten:</strong> <span id="correctAnswers">0</span>/<span id="totalQuestions">0</span></p>
                    <p><strong>Zeit:</strong> <span id="timeSpent">0</span> Sekunden</p>
                    <p><strong>Thema:</strong> <span id="resultTopic">Lade...</span></p>
                </div>

                <!-- GARANTIERT SICHTBARE CONTAINER -->
                <div id="detailedResults" class="results-container">
                    <h3 style="text-align: center; margin: 30px 0 20px 0; color: #333;">ğŸ“‹ Detaillierte Antwort-Analyse</h3>
                    <div id="questionsContainer">
                        <!-- Hier werden die Fragen dynamisch eingefÃ¼gt -->
                    </div>
                </div>

                <div id="feedbackResults" class="results-container">
                    <h3 style="text-align: center; margin: 30px 0 20px 0; color: #333;">ğŸ§  Umfassende KI-Analyse</h3>
                    <div id="feedbackContainer">
                        <!-- Hier wird das Feedback dynamisch eingefÃ¼gt -->
                    </div>
                </div>

                <div style="margin-top: 30px;">
                    <button onclick="newTest()" class="success" style="margin: 5px;">ğŸ”„ Neuer Test</button>
                    <button onclick="goToDashboard()" class="secondary" style="margin: 5px;">ğŸ“Š Zum Dashboard</button>
                </div>
            </div>
        </div>

        <!-- Debug Output -->
        <div class="card">
            <h2>ğŸ” Test-Status</h2>
            <div id="output" class="output">
                Konfiguriere deinen Test und starte ihn!
            </div>
        </div>
    </div>
    <script src="/static/common.js"></script>
    <script src="/static/test.js"></script>
</body>
</html>